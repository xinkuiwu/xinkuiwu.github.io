<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>数据库- MongoDB搭建和使用 | 伍新奎的博客空间</title><meta name="author" content="伍新奎"><meta name="copyright" content="伍新奎"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="搭建：从零到一搭建数据库打开MongoDB的下载地址，选择以下配置再下载。（右键复制下载地址）打开浏览器下载列表，查看当前文件的下载的地址为https:&#x2F;&#x2F;fastdl.mongodb.org&#x2F;linux&#x2F;mongodb-linux-x86_64-rhel80-5.0.6.tgz，再取消当前的下载。 安装打开CMD工具，登录服务器。因为yum不存在Mongodb源，所以无法执行yum instal">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库- MongoDB搭建和使用">
<meta property="og:url" content="http://example.com/2023/09/10/blog92/index.html">
<meta property="og:site_name" content="伍新奎的博客空间">
<meta property="og:description" content="搭建：从零到一搭建数据库打开MongoDB的下载地址，选择以下配置再下载。（右键复制下载地址）打开浏览器下载列表，查看当前文件的下载的地址为https:&#x2F;&#x2F;fastdl.mongodb.org&#x2F;linux&#x2F;mongodb-linux-x86_64-rhel80-5.0.6.tgz，再取消当前的下载。 安装打开CMD工具，登录服务器。因为yum不存在Mongodb源，所以无法执行yum instal">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/blog_wxk.jpg">
<meta property="article:published_time" content="2023-09-10T09:02:00.000Z">
<meta property="article:modified_time" content="2023-12-05T12:52:09.477Z">
<meta property="article:author" content="伍新奎">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="MongoDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/blog_wxk.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/09/10/blog92/index.html"><link rel="preconnect" href="https://lib.baomitu.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/6.4.2/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://lib.baomitu.com/fancyapps-ui/5.0.24/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://lib.baomitu.com/egjs-infinitegrid/4.10.1/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据库- MongoDB搭建和使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-05 20:52:09'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/blog_wxk.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">96</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">150</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">68</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="伍新奎的博客空间"><span class="site-name">伍新奎的博客空间</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">数据库- MongoDB搭建和使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-09-10T09:02:00.000Z" title="Created 2023-09-10 17:02:00">2023-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">MongoDB</a></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h3 id="搭建：从零到一搭建数据库"><a href="#搭建：从零到一搭建数据库" class="headerlink" title="搭建：从零到一搭建数据库"></a>搭建：从零到一搭建数据库</h3><p>打开MongoDB的<a href="https://link.juejin.cn/?target=https://www.mongodb.com/try/download/community">下载地址</a>，选择以下配置再下载。（右键复制下载地址）打开浏览器下载列表，查看当前文件的下载的地址为<a target="_blank" rel="noopener" href="https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-5.0.6.tgz%EF%BC%8C%E5%86%8D%E5%8F%96%E6%B6%88%E5%BD%93%E5%89%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E3%80%82">https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-5.0.6.tgz，再取消当前的下载。</a><br><img src="/2023/09/10/blog92/1700126634868-f63f43e9-7697-4ad8-b701-df4264a70c18.webp"></p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>打开CMD工具，登录服务器。因为yum不存在Mongodb源，所以无法执行yum install mongodb安装MongoDB。通过以下方式手动安装MongoDB。<br>进入工具目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码cd /tool</span><br></pre></td></tr></table></figure>

<p>下载MongoDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel80-5.0.6.tgz</span><br></pre></td></tr></table></figure>

<p>解压MongoDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码tar -zxvf mongodb-linux-x86_64-rhel80-5.0.6.tgz -C /tool</span><br></pre></td></tr></table></figure>

<p>重命名目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码mv mongodb-linux-x86_64-rhel80-5.0.6 mongodb</span><br></pre></td></tr></table></figure>

<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><p>安装完毕还需手动增加一些配置，为了方便管理MongoDB相关文件，将这些配置文件都存放到mongodb文件夹中。<br>进入目录并创建文件夹与日志文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码cd mongodb &amp;&amp; mkdir data &amp;&amp; mkdir log &amp;&amp; touch log/mongodb.log</span><br></pre></td></tr></table></figure>

<p>生效环境变量<br>设置软链接，可通过mongod快速调用命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码echo &quot;export PATH=$PATH:/tool/mongodb/bin&quot; &gt;&gt; ~/.bash_profile</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<hr>
<p>执行vim &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf，加入以下内容。该文件作为MongoDB的配置文件，在执行mongod时必须指定配置文件的路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码# 数据库</span><br><span class="line">dbpath=/tool/mongodb/data</span><br><span class="line"># 日志文件</span><br><span class="line">logpath=/tool/mongodb/log/mongodb.log</span><br><span class="line"># 使用追加的方式更新日志</span><br><span class="line">logappend=true</span><br><span class="line"># 端口</span><br><span class="line">port=27017</span><br><span class="line"># 以守护进程的方式运行MongoDB(创建服务器进程)</span><br><span class="line">fork=true</span><br><span class="line"># 启用用户验证</span><br><span class="line"># auth=true</span><br><span class="line"># 绑定服务IP(绑定127.0.0.1只能本机访问，若不指定则默认本地所有IP)</span><br><span class="line">bind_ip=0.0.0.0</span><br></pre></td></tr></table></figure>

<p>执行mongod -f &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf启动MongoDB，输出以下信息表示开启成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码about to fork child process, waiting until server is ready for connections.</span><br><span class="line">forked process: 2028</span><br><span class="line">child process started successfully, parent exiting</span><br></pre></td></tr></table></figure>

<p>执行ps -ef | grep mongod查看MongoDB状态，输出以下信息表示MongoDB正常运行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码root        2028       1  0 22:44 ?        00:00:02 mongod -f /tool/mongodb/mongodb.conf</span><br><span class="line">root        2281    2072  0 22:48 pts/3    00:00:00 grep --color=auto mongod</span><br></pre></td></tr></table></figure>

<p>执行mongod –shutdown -f &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf关闭MongoDB，输出以下信息表示关闭成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码killing process with pid: 2028</span><br></pre></td></tr></table></figure>

<p>若无使用MongoDB的应用在运行，请关闭MongoDB，这样才能让服务器在CPU低占用的情况下保持稳定的性能。当用到MongoDB时再开启也不迟。</p>
<h5 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h5><p>在启动MongoDB的情况下，执行mongo连接MongoDB，输出以下信息表示连接成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码MongoDB shell version v5.0.6</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;a1cb8b2e-3ac2-4be9-8547-eb161c4dea74&quot;) &#125;</span><br><span class="line">MongoDB server version: 5.0.6</span><br></pre></td></tr></table></figure>

<p>连接MongoDB后，终端会进入MongoDB模式，该模式可执行MongoDB相关命令，可查看<a href="https://link.juejin.cn/?target=https://www.runoob.com/mongodb/mongodb-tutorial.html">MongoDB教程</a>，在此不深入讲述了。<br>执行use admin切换到admin数据库，该数据库是MongoDB的默认数据库，用于管理用户权限。在上述配置文件中并未开启auth&#x3D;true，因此创建root用户后需开启auth&#x3D;true。<br>执行以下命令为admin数据库创建root用户。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码db.createUser(&#123; user: &quot;root&quot;, pwd: &quot;123456&quot;, roles: [&#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br></pre></td></tr></table></figure>

<p>输出以下信息表示创建成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码Successfully added user: &#123;</span><br><span class="line">	&quot;user&quot;: &quot;root&quot;,</span><br><span class="line">	&quot;roles&quot;: [&#123;</span><br><span class="line">		&quot;role&quot;: &quot;root&quot;,</span><br><span class="line">		&quot;db&quot;: &quot;admin&quot;</span><br><span class="line">	&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行vim &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf将# auth&#x3D;true的#去掉，重启MongoDB。重启动作包括mongod -f &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf与mongod –shutdown -f &#x2F;tool&#x2F;mongodb&#x2F;mongodb.conf。<br>执行以下命令，输出1表示用户登录成功。接着可基于MongoDB操作数据了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">复制代码use admin</span><br><span class="line">db.auth(&quot;root&quot;, &quot;123456&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">## 这步开始刚刚安装好mongodb,没有进行什么操作</span><br><span class="line">use admin</span><br><span class="line">#创建管理员账户（不能创建数据库）</span><br><span class="line">db.createUser(&#123; user: &quot;admin&quot;, pwd: &quot;123456&quot;, roles: [&#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br><span class="line"># 创建超级管理员（可以创建数据库）</span><br><span class="line">db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;123456&quot;,roles:[&#123;role: &#x27;root&#x27;, db: &#x27;admin&#x27;&#125;]&#125;)</span><br><span class="line"># 退出</span><br><span class="line">exit</span><br><span class="line"># 登录admin 数据库</span><br><span class="line">mongo admin</span><br><span class="line"># root管理员登录</span><br><span class="line">db.auth(&#x27;root&#x27;,&#x27;123456&#x27;);</span><br><span class="line"># 创建test数据库</span><br><span class="line">use test;</span><br><span class="line"># 查看是否有test数据库，结果是没有的</span><br><span class="line">show dbs </span><br><span class="line"># 需要往里面添加数据，test才会生成</span><br><span class="line">db.createCollection(&quot;list&quot;)</span><br><span class="line"># 查看是否有test数据库，结果是有的</span><br><span class="line">show dbs</span><br><span class="line">#退出</span><br><span class="line">exit</span><br><span class="line"># 重新mongo服务</span><br><span class="line"># 进行mongo 初始化认证，这步是Authentication failed 和connect failed问题解决步骤（这步开始是已经创建好root账号和创建test数据库）</span><br><span class="line">mongod --auth --dbpath=/data/db --logpath=/data/log</span><br><span class="line"># 登录admin 数据库</span><br><span class="line">mongo admin -u root -p 123456</span><br><span class="line"># 进入 test</span><br><span class="line">use test;</span><br><span class="line"># 创建test数据库的管理员</span><br><span class="line">db.createUser(&#123;user: &quot;user1&quot;, pwd: &quot;123456&quot;, roles:[&quot;dbOwner&quot;]&#125;)</span><br><span class="line"># 退出</span><br><span class="line">exit</span><br><span class="line"># 可以登录，问题解决</span><br><span class="line">mongo test -u user1 -p 123456</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在不熟悉MongoDB命令的情况下，盲目操作数据库会引发很大风险，因此不建议在CMD工具中操作MongoDB。好在MongoDB官方提供一个界面漂亮操作流畅的GUI工具MongoDB Compass，不习惯命令操作MongoDB的同学可用Compass。打开Compass的<a href="https://link.juejin.cn/?target=https://www.mongodb.com/try/download/compass">下载地址</a>，选择以下配置再下载。<br><img src="/2023/09/10/blog92/1700126635937-15298c08-5ae8-4b9a-a803-889597e17370.webp"><br>打开Compass，发现需填写一条MongoDB标准URL才能连接数据库。<br><img src="/2023/09/10/blog92/1700126634900-3d93fd2d-203e-408f-b828-26930d0299f4.webp"><br>MongoDB标准URL是什么？它是MongoDB基于shell命令连接数据库的标准化URL，由以下参数组成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">txt</span><br><span class="line">复制代码mongodb://username:password@host:port/database[?options]</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>mongodb:&#x2F;&#x2F;</td>
<td>协议</td>
<td>可理解成HTTP</td>
</tr>
<tr>
<td>username</td>
<td>账号</td>
<td>上述创建的root</td>
</tr>
<tr>
<td>password</td>
<td>密码</td>
<td>上述创建的root的密码123456</td>
</tr>
<tr>
<td>host</td>
<td>实例公有IP</td>
<td>云服务器IP</td>
</tr>
<tr>
<td>port</td>
<td>端口</td>
<td>默认27017</td>
</tr>
<tr>
<td>database</td>
<td>数据库</td>
<td>上述切换的admin数据库</td>
</tr>
<tr>
<td>options</td>
<td>配置</td>
<td>用得很少</td>
</tr>
</tbody></table>
<p>那拼接起来的URL就是mongodb:&#x2F;&#x2F;root:<a href="mailto:&#x31;&#50;&#x33;&#52;&#x35;&#54;&#64;&#97;&#97;&#x61;&#x2e;&#98;&#x62;&#x62;&#46;&#x63;&#99;&#99;&#46;&#100;&#x64;&#x64;">&#x31;&#50;&#x33;&#52;&#x35;&#54;&#64;&#97;&#97;&#x61;&#x2e;&#98;&#x62;&#x62;&#46;&#x63;&#99;&#99;&#46;&#100;&#x64;&#x64;</a>:27017&#x2F;admin，输入到Compass中就可连接数据库了。首次连接肯定失败，那是因为还未配置服务器的安全组。<br>每次新开端口都需在服务器中配置安全组，可回看第7章的个人官网-安全组配置那部分内容。这次增加27017端口，那在安全组中配置一个27017端口。再次连接MongoDB就可正常访问了。<br><img src="/2023/09/10/blog92/1700126634901-b2504c7b-b4d4-4f92-8a4a-16f1b44b7c51.webp"><br>注意配置文件bind_ip不要写127.0.0.1，不然只能服务器本机访问数据库了。<br><img src="/2023/09/10/blog92/1700188901631-6e8f4784-c4d1-4c3b-a97f-d66c6db414cf.png" alt="image.png"></p>
<h3 id="开发：初试小型接口系统"><a href="#开发：初试小型接口系统" class="headerlink" title="开发：初试小型接口系统"></a>开发：初试小型接口系统</h3><p>自行部署数据库相比选购第三方平台数据可省下好几千元。因为MongoDB文档的概念与JSON很相似，所以很多开发者都会把MongoDB作为首选数据库。<br>为了让MongoDB能派上用场，以下会在Node环境中结合mongoose开发一个小型接口系统，通过Nginx代理接口，输出一个可基于HTTPS访问的接口系统。设计该场景的目的是为了让你掌握以下技能，通过数据库、数据操作和接口调试三个突破点学习接口系统的搭建思路。当然代码内容不是主要，主要的是搭建思路的大体框架。<br><img src="/2023/09/10/blog92/1700126635007-ee7fde93-3c7f-4cd3-b484-b26107d6e75f.webp"><br>在本地环境创建项目data-base，使用koa创建Node服务，该服务启动后初始全部接口的路由实例，每个路由实例根据需求处理数据并使用mongoose读写数据库。（<strong>用nestjs体验更好</strong>)<br>该服务提供一个产品的增删改查功能，整体围绕着产品数据做读写操作。</p>
<h5 id="初始项目"><a href="#初始项目" class="headerlink" title="初始项目"></a>初始项目</h5><p>执行npm init创建package.json，执行以下命令安装项目所需依赖。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i cross-env dayjs koa koa-body koa-json koa-logger koa-onerror koa-router mongoose</span><br><span class="line">npm i nodemon -D</span><br></pre></td></tr></table></figure>

<h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><p>在根目录中创建src文件夹，在该文件夹中创建入口文件index.js。该文件使用koa创建Node服务，接入一些常见中间件升级koa的功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import Koa from &quot;koa&quot;;</span><br><span class="line">import &#123; koaBody &#125; from &quot;koa-body&quot;;</span><br><span class="line">import KoaJson from &quot;koa-json&quot;;</span><br><span class="line">import KoaLogger from &quot;koa-logger&quot;;</span><br><span class="line">import KoaOnerror from &quot;koa-onerror&quot;;</span><br><span class="line"></span><br><span class="line">// 创建实例</span><br><span class="line">const app = new Koa();</span><br><span class="line">KoaOnerror(app); // 美化错误参数</span><br><span class="line">app.on(&quot;error&quot;, (err, ctx) =&gt; console.error(&quot;server error&quot;, err, ctx)); // 捕获错误</span><br><span class="line"></span><br><span class="line">// 配置中间件</span><br><span class="line">app.use(KoaLogger()); // 日志解析</span><br><span class="line">app.use(koaBody(&#123; multipart: true &#125;)); // Body解析</span><br><span class="line">app.use(KoaJson()); // JSON解析</span><br><span class="line"></span><br><span class="line">// 监听服务</span><br><span class="line">app.listen(3000);</span><br><span class="line">console.log(&quot;===Node服务已启动，监听端口3000 ===&quot;);</span><br></pre></td></tr></table></figure>

<p>（需要在package.json 添加：  “type”: “module”）</p>
<p>这样一个基础的Node服务就搭建好了。在package.json中指定scripts，加入开发环境与生产环境的启动命令。在开发环境中为了修改代码后能重启Node服务，使用nodemon代理node的启动功能，可回看第2章的监听脚本自动重启命令那部分内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;scripts&quot;: &#123;</span><br><span class="line">		&quot;clean&quot;: &quot;rimraf coverage dist node_modules package-lock.json yarn.lock&quot;,</span><br><span class="line">		&quot;deploy&quot;: &quot;cross-env NODE_ENV=prod node --es-module-specifier-resolution=node src/index.js&quot;,</span><br><span class="line">		&quot;start&quot;: &quot;cross-env NODE_ENV=dev nodemon --es-module-specifier-resolution=node src/index.js&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>执行npm start，输出以下信息表示启动成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Node服务已启动，监听端口3000</span><br></pre></td></tr></table></figure>

<h5 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h5><p>有了上述搭建好的MongoDB作为载体，整个接口系统在执行时产生的数据都经过MongoDB处理，处理MongoDB数据当然离不开mongoose。<br><strong>mongoose</strong>是一个在Node环境中操作MongoDB对象模型的Npm模块，其封装了MongoDB对文档增删改查的方法。其文档已很完善，可查看<a href="https://link.juejin.cn/?target=https://mongoosejs.com/docs/guide.html">mongoose文档</a>，在此不深入讲述了。<br>还记得MongoDB标准URL的组成吗？连接数据库需用到它。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongodb://username:password@host:port/database[?options]</span><br></pre></td></tr></table></figure>

<p>为了方便管理这些参数，在src文件夹中创建app.config.js文件。在本地环境使用实例公有IP，在服务器环境使用127.0.0.1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; env &#125; from &quot;process&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">	mongodb: &#123;</span><br><span class="line">		host: env.NODE_ENV === &quot;dev&quot; ? &quot;your server host&quot; : &quot;127.0.0.1&quot;,</span><br><span class="line">		password: &quot;123456&quot;,</span><br><span class="line">		port: 27017,</span><br><span class="line">		username: &quot;root&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>安装mongoose依赖；<br>在src文件夹中创建database&#x2F;index.js文件。使用connect()连接数据库，使用connection()监听数据库状态事件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import Mongoose from &quot;mongoose&quot;;</span><br><span class="line"></span><br><span class="line">import AppConfig from &quot;../app.config&quot;;</span><br><span class="line"></span><br><span class="line">const &#123; connect, connection &#125; = Mongoose;</span><br><span class="line">const &#123; mongodb: &#123; host, password, port, username &#125; &#125; = AppConfig;</span><br><span class="line"></span><br><span class="line">connect(`mongodb://$&#123;username&#125;:$&#123;password&#125;@$&#123;host&#125;:$&#123;port&#125;/mall`, &#123;</span><br><span class="line">	authSource: &quot;admin&quot;,</span><br><span class="line">	useNewUrlParser: true,</span><br><span class="line">	useUnifiedTopology: true</span><br><span class="line">&#125;);</span><br><span class="line">connection.on(&quot;connected&quot;, () =&gt; console.log(&quot;数据库连接成功&quot;));</span><br><span class="line">connection.on(&quot;disconnected&quot;, () =&gt; console.log(&quot;数据库连接断开&quot;));</span><br><span class="line">connection.on(&quot;error&quot;, () =&gt; console.log(&quot;数据库连接异常&quot;));</span><br></pre></td></tr></table></figure>


<p>保存文件后会自动重启Node服务（需要引入database&#x2F;index.js），输出以下信息表示启动成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Node服务已启动，监听端口3000</span><br><span class="line">数据库连接成功</span><br></pre></td></tr></table></figure>

<h5 id="定义数据"><a href="#定义数据" class="headerlink" title="定义数据"></a>定义数据</h5><p>mongoose中有三个很重要的概念，分别是Schema、Model和Entity。（Schema 用来定义数据结构和规则，Model 用来执行数据库操作，Entity 则是 Model 的实例，代表了数据库中的具体数据。）</p>
<ul>
<li><strong>Schema</strong>: 表示模式，一种以文档形式存储的数据库模型骨架，不具备数据库操作能力</li>
<li><strong>Model</strong>: 表示模型，由Schema生成的模型，具备抽象属性与数据库操作能力</li>
<li><strong>Entity</strong>: 表示实例，由Model创建的实例，具备操作数据库操作能力</li>
</ul>
<p>mongoose中任何事物都要从Schema开始。每个Schema对应MongoDB中的一个集合Collection。Schema中定义了集合中文档Document的格式。<br>通过Schema为产品数据定义一个模式，再通过Model为产品模式定义一个模型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">js</span><br><span class="line">复制代码import Day from &quot;dayjs&quot;;</span><br><span class="line">import Mongoose from &quot;mongoose&quot;;</span><br><span class="line"></span><br><span class="line">const &#123; model, Schema &#125; = Mongoose;</span><br><span class="line"></span><br><span class="line">// 定义模式</span><br><span class="line">const Product = &#123;</span><br><span class="line">	brand: &#123;</span><br><span class="line">		match: /^.&#123;2,200&#125;$/,</span><br><span class="line">		msg: &quot;品牌只能由2到200位任意字符组成&quot;,</span><br><span class="line">		required: true,</span><br><span class="line">		trim: true,</span><br><span class="line">		type: String</span><br><span class="line">	&#125;,</span><br><span class="line">	code: &#123;</span><br><span class="line">		match: /^[A-Za-z0-9]&#123;4,30&#125;$/,</span><br><span class="line">		msg: &quot;条形码只能由4到30位英文或数字组成&quot;,</span><br><span class="line">		required: true,</span><br><span class="line">		trim: true,</span><br><span class="line">		type: String</span><br><span class="line">	&#125;,</span><br><span class="line">	createtime: &#123; ... &#125;,</span><br><span class="line">	description: &#123; ... &#125;,</span><br><span class="line">	name: &#123; ... &#125;</span><br><span class="line">	origin: &#123; ... &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// 定义模型</span><br><span class="line">const ProductModel = model(&quot;product&quot;, new Schema(Product, &#123; versionKey: false &#125;));</span><br><span class="line"></span><br><span class="line">export &#123;</span><br><span class="line">	Product,</span><br><span class="line">	ProductModel</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>其中每个产品数据都使用type定义数据类型，其类型值只能使用以下有效类型。String、Number、Boolean、Array和Date为原生数据类型，无需引用可直接使用。Buffer为Node的特有数据类型，可查看<a href="https://link.juejin.cn/?target=https://nodejs.org/dist/latest-v18.x/docs/api/buffer.html">Node Buffer</a>。ObjectId与Mixed为mongoose定义的数据类型。ObjectId表示主键，每个Schema都会默认配置该属性，键值为_id，在数据入库时会自动创建。Mixed表示混合类型，可认为是引用类型的对象Object。<br><img src="/2023/09/10/blog92/1700126635323-fc427ad8-b74b-4d7d-acbd-2bca592ffc6e.webp"><br>通过export导出Product(产品模式)与ProductModel(产品类型)，就能在路由实例中自由操作MongoDB了。</p>
<h5 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h5><p>示例是一个小型接口系统，仅仅是为了配合本课程讲述数据库的搭建与操作，所以在代码形式上更多是为了确保搭建好的数据库的可用性与稳定性，因此只编写了产品的增删改查四个接口供你学习，对于更多其他需求的接口，可根据本章学习的内容自行编写。<br>新增产品<br>使用koa-router创建路由实例，该实例提供get()与post()定义接口类型。两个方法需传入两个参数，第一个是接口路径，第二个参数是上下文。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">js</span><br><span class="line">复制代码import KoaRouter from &quot;koa-router&quot;;</span><br><span class="line">import &#123; AsyncTo &#125; from &quot;@yangzw/bruce-us/dist/node&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; Product, ProductModel &#125; from &quot;../../models&quot;;</span><br><span class="line">import &#123; CheckData &#125; from &quot;../../utils/setting&quot;;</span><br><span class="line"></span><br><span class="line">const Router = KoaRouter();</span><br><span class="line"></span><br><span class="line">Router.post(&quot;/mall/product/create&quot;, async ctx =&gt; &#123;</span><br><span class="line">	// 接口逻辑</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default Router;</span><br></pre></td></tr></table></figure>

<p>接口路径的前缀在开发环境与生产环境可能不尽相同。在开发环境中为了方便可能需省略前缀&#x2F;mall，在生产环境中为了区分不同系统就必须增加前缀。<br>在上线前会确认开发环境与生产环境的接口URL。</p>
<p>基于上述确定情况，可用一个变量控制该前缀。在app.config.js加入以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js</span><br><span class="line">复制代码export default &#123;</span><br><span class="line">	// ...</span><br><span class="line">	publicPath: env.NODE_ENV === &quot;dev&quot; ? &quot;&quot; : &quot;/mall&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接着开发第一个接口：<strong>新增产品</strong>。新增产品需用到几个参数，分别是brand、logo、description、name和origin，无需createtime是因为可在数据入库时自动创建时间。<br>在开发接口时，需做到以下细节才能保障数据的准确性、安全性、可靠性和稳定性。</p>
<ul>
<li>校验全部字段是否为空</li>
<li>校验全部字段是否符合正则</li>
<li>根据某个字段判断文档是否存在</li>
<li>读写数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">js</span><br><span class="line">复制代码Router.post(`$&#123;AppConfig.publicPath&#125;/product/create`, async ctx =&gt; &#123;</span><br><span class="line">	const params = ctx.request.body;</span><br><span class="line">	// 校验全部字段是否为空</span><br><span class="line">	if (!CheckData(params, 5)) &#123;</span><br><span class="line">		ctx.body = &#123; code: 300, msg: &quot;产品信息都不能为空&quot; &#125;;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	// 校验全部字段是否符合正则</span><br><span class="line">	const checkMsg = Object.entries(params).reduce((t, v) =&gt; &#123;</span><br><span class="line">		const &#123; match, msg &#125; = Product[v[0]];</span><br><span class="line">		return !t &amp;&amp; !match.test(v[1]) ? &#123; code: 400, msg &#125; : t;</span><br><span class="line">	&#125;, &quot;&quot;);</span><br><span class="line">	if (checkMsg) &#123;</span><br><span class="line">		ctx.body = checkMsg;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	// 判断产品是否存在</span><br><span class="line">	const [err1, res1] = await AsyncTo(ProductModel.findOne(&#123; code: params.code &#125;));</span><br><span class="line">	if (err1) &#123;</span><br><span class="line">		ctx.body = &#123; code: 400, msg: &quot;新增产品失败&quot; &#125;;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	if (res1) &#123;</span><br><span class="line">		ctx.body = &#123; code: 400, msg: &quot;当前产品已存在&quot; &#125;;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	// 新增产品</span><br><span class="line">	const [err2, res2] = await AsyncTo(ProductModel.create(params));</span><br><span class="line">	if (!err2 &amp;&amp; res2) &#123;</span><br><span class="line">		ctx.body = &#123; code: 200, data: res2, msg: &quot;新增产品成功&quot; &#125;;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		ctx.body = &#123; code: 400, msg: &quot;新增产品失败&quot; &#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>若使用post()可通过ctx.request.body获取入参，若使用get()可通过ctx.request.query获取入参。<br>剩余的删除产品、更新产品和读取产品也可用同样套路处理，在此不深入讲述了。</p>
<h3 id="调试：测试接口可行性"><a href="#调试：测试接口可行性" class="headerlink" title="调试：测试接口可行性"></a>调试：测试接口可行性</h3><p>接口系统运行起来，那就要测试每个接口的可行性，确保接口能正常使用。<br><strong>Postman</strong>是一款功能强大用于测试HTTP请求的接口调试工具。虽然不能像QA那样用得很精，但必须知道如何创建与调试接口请求。</p>
<p>打开Postman的<a href="https://link.juejin.cn/?target=https://www.postman.com/downloads">下载地址</a>，根据系统选择适合的安装包再下载。</p>
<h5 id="创建请求"><a href="#创建请求" class="headerlink" title="创建请求"></a>创建请求</h5><p>安装完毕打开Postman，点击Get按钮创建请求。<br><img src="/2023/09/10/blog92/1700126635354-4915cfd4-d955-4cb5-adf4-fd0e60ac5fcd.webp"></p>
<h5 id="配置请求"><a href="#配置请求" class="headerlink" title="配置请求"></a>配置请求</h5><p>在以下圈住的位置输入准确的参数信息，从左到右从上往下依次讲述。</p>
<ul>
<li><strong>请求名称</strong>：简要说明接口功能，可用文件夹分类</li>
<li><strong>请求类型</strong>：包括15种请求类型，很多情况选择GET或POST</li>
<li><strong>请求地址</strong>：完整的接口请求路径</li>
<li><strong>Params</strong>：请求参数，用于GET入参，对应以下表格的数据</li>
<li><strong>Body</strong>：请求体，用于POST入参，对应以下表格的数据</li>
</ul>
<p>Body可选none&#x2F;form-data&#x2F;x-www-from-urlencoded等，无参数选none，普通入参选x-www-from-urlencoded，表单入参选form-data。<br><img src="/2023/09/10/blog92/1700126635385-872790c3-d016-44df-b052-dca715fe0906.webp"><br>输入完毕点击Send，输出以下信息表示请求成功。<br><img src="/2023/09/10/blog92/1700126635604-c9fc7828-0fbc-4b4b-aa1b-d931161a4ab9.webp"><br>请求成功会在数据库中记录该文档。打开Compass，点击刷新按钮，就能看到mongoose自动为MongoDB创建了一个数据库mall，其中又创建了一个集合products。MongoDB有一个很好的功能就是存在某个数据库则使用它，不存在则自动创建。<br><img src="/2023/09/10/blog92/1700126635831-24e33524-17c8-44c1-bf61-7b8ecf9ef778.webp"><br><img src="/2023/09/10/blog92/1700126635678-9cbeb990-083f-4c3d-adb2-b831a7f1da79.webp"><br>回顾上述代码，mall数据库是通过以下代码自动创建的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(`mongodb://$&#123;username&#125;:$&#123;password&#125;@$&#123;host&#125;:$&#123;port&#125;/mall`, &#123; ... &#125;);</span><br></pre></td></tr></table></figure>

<p>products集合是通过以下代码自动创建的。为何定义Model的名称是product却生成products？因为在创建时mongoose会动态分析名称的词法，对不是复数的单词会追加s或es的后缀，所以在使用model()定义一个模型时，建议采用单词的单数形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model(&quot;product&quot;, new Schema(Product, &#123; versionKey: false &#125;));</span><br></pre></td></tr></table></figure>

<p>使用相同方法在Postman中测试其余三个接口，若全部通过就表示本地环境运行的接口可行性测试通过。<br><img src="/2023/09/10/blog92/1700126635807-2051de71-62b1-4226-a88d-64ec78660adf.webp"></p>
<h3 id="部署：发布到服务器"><a href="#部署：发布到服务器" class="headerlink" title="部署：发布到服务器"></a>部署：发布到服务器</h3><p>上述都在本地环境部署，因此也只能在本地环境运行接口系统。若要在外网通过HTTPS访问接口系统，还需将Node服务发布到服务器环境中。</p>
<p>打开FTP工具，在&#x2F;www&#x2F;server目录中创建data-base文件夹，把本地的data-base文件夹中除了node_modules文件夹的其他内容上传上去。执行npm i安装依赖。<br>打开CMD工具，登录服务器。在&#x2F;etc&#x2F;nginx&#x2F;conf.d目录中创建api.yangzw.vip.conf文件，执行vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;api.yangzw.vip.conf，加入以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	server_name api.yangzw.vip;</span><br><span class="line">	location /mall &#123;</span><br><span class="line">		proxy_pass http://127.0.0.1:3000;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">		proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">	&#125;</span><br><span class="line">	location /blog &#123;</span><br><span class="line">		proxy_pass http://127.0.0.1:3001;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">		proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">	&#125;</span><br><span class="line">	location /resume &#123;</span><br><span class="line">		proxy_pass http://127.0.0.1:3002;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">		proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>最后执行nginx -t验证Nginx配置，再执行nginx -s reload重启Nginx进程。执行npm run deploy启动服务。</p>
<h5 id="调试接口"><a href="#调试接口" class="headerlink" title="调试接口"></a>调试接口</h5><p>回到Postman的新增产品的接口，将<a href="http://127.0.0.1:3000改成https://api.yangzw.vip/mall。">http://127.0.0.1:3000改成https://api.yangzw.vip/mall。</a><br>输入完毕点击Send，输出以下信息表示请求成功。若不成功请检查上述步骤，看看是哪里遗漏了。<br><img src="/2023/09/10/blog92/1700126636012-eafbaffd-758f-494f-bb75-6f1d28f4df16.webp"><br>在默认情况下，开发环境与生产环境的接口域名都不会一样，但接口路径却一样。在Postman中遇到不同环境调试接口，那得把改接口域名改来改去了。<br>在Postman右上角的环境变量中选择No Environment，点击右边的查看图标，再点击Add按钮。<br><img src="/2023/09/10/blog92/1700126636159-d5203e11-f33c-432f-a3f8-57db45f430f1.webp"><br>输入全局环境的名称，设置当前环境中的变量内容。分别创建开发环境与生产环境的变量。<br><img src="/2023/09/10/blog92/1700126636189-abfc8eb3-9604-4049-821f-4aacad05eda5.webp"><br><img src="/2023/09/10/blog92/1700126636349-8907546a-b073-42ae-a05f-c99cc33a4d7c.webp"><br>创建完毕就能愉快地调试不同环境中的接口实例了。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/MongoDB/">MongoDB</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/20/blog93/" title="nodejs-PM2搭建和使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">nodejs-PM2搭建和使用</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/23/blog91/" title="前端工程化-代码提交规范 | 公司项目"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">前端工程化-代码提交规范 | 公司项目</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/blog_wxk.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">伍新奎</div><div class="author-info__description">前端开发工程师</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">96</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">150</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">68</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xinkuiwu"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%EF%BC%9A%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E6%90%AD%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">搭建：从零到一搭建数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.0.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.0.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.0.3.</span> <span class="toc-text">连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%EF%BC%9A%E5%88%9D%E8%AF%95%E5%B0%8F%E5%9E%8B%E6%8E%A5%E5%8F%A3%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.</span> <span class="toc-text">开发：初试小型接口系统</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.0.1.</span> <span class="toc-text">初始项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.0.2.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.0.3.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE"><span class="toc-number">2.0.4.</span> <span class="toc-text">定义数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.0.5.</span> <span class="toc-text">定义接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3%E5%8F%AF%E8%A1%8C%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">调试：测试接口可行性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AF%B7%E6%B1%82"><span class="toc-number">3.0.1.</span> <span class="toc-text">创建请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%B7%E6%B1%82"><span class="toc-number">3.0.2.</span> <span class="toc-text">配置请求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%EF%BC%9A%E5%8F%91%E5%B8%83%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">部署：发布到服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.0.1.</span> <span class="toc-text">调试接口</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/23/blog96/" title="nestjs学习-5种http数据传输方式">nestjs学习-5种http数据传输方式</a><time datetime="2023-11-23T08:02:00.000Z" title="Created 2023-11-23 16:02:00">2023-11-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/23/blog95/" title="nestjs学习-快速掌握 Nest CLI">nestjs学习-快速掌握 Nest CLI</a><time datetime="2023-11-23T08:02:00.000Z" title="Created 2023-11-23 16:02:00">2023-11-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/15/blog90/" title="前端工程化- webpack | 项目打包webpack优化">前端工程化- webpack | 项目打包webpack优化</a><time datetime="2023-11-15T03:02:00.000Z" title="Created 2023-11-15 11:02:00">2023-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/01/blog94/" title="单元测试-jest搭建和使用">单元测试-jest搭建和使用</a><time datetime="2023-11-01T06:02:00.000Z" title="Created 2023-11-01 14:02:00">2023-11-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/20/blog93/" title="nodejs-PM2搭建和使用">nodejs-PM2搭建和使用</a><time datetime="2023-10-20T03:02:00.000Z" title="Created 2023-10-20 11:02:00">2023-10-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 伍新奎</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://lib.baomitu.com/fancyapps-ui/5.0.24/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>